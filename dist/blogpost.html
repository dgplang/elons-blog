<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elon Team's Blog</title>
  <!-- <script src="https://cdn.tailwindcss.com"></script> -->
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <!-- Mobile Responsive Navigation -->
  <nav class="bg-white shadow p-4 flex justify-between items-center md:flex-row flex-col">
    <h1 class="text-2xl font-bold text-blue-600 mb-2 md:mb-0">Elon Team's Blog</h1>
    <div class="flex flex-wrap gap-2 justify-center">
      <button class="bg-blue-500 text-white rounded-full px-4 py-2 hover:bg-blue-600">Unused</button>
      <button class="bg-green-500 text-white rounded-full px-4 py-2 hover:bg-green-600">Unused</button>
      <button class="bg-purple-500 text-white rounded-full px-4 py-2 hover:bg-purple-600">Unused</button>
      <button class="bg-yellow-500 text-white rounded-full px-4 py-2 hover:bg-yellow-600">Unused</button>
      <button class="bg-pink-500 text-white rounded-full px-4 py-2 hover:bg-pink-600">Unsued</button>
      <button id="logoutBtn" class="bg-red-500 text-white rounded-full px-4 py-2 hover:bg-red-600">Logout</button>
    </div>
  </nav>

  <!-- Blog Post Creation Section -->
  <main class="flex-grow container mx-auto p-4">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Create a New Blog Post</h2>
    <form id="postForm" class="bg-white shadow-md rounded p-6 space-y-4">
      <input id="title" type="text" placeholder="Post Title" class="w-full border px-4 py-2 rounded" required />
      <textarea id="content" placeholder="Post Content" class="w-full border px-4 py-2 rounded" rows="6" required></textarea>
      <input id="category_id" type="number" placeholder="Category ID" class="w-full border px-4 py-2 rounded" required />
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Submit</button>
      <p id="responseMessage" class="text-sm font-medium"></p>
    </form>
  </main>

  <script>
    // Get the logged-in user's email from localStorage
    const loggedInEmail = localStorage.getItem("loggedInEmail");

    // Load logout button functionality
    const logoutBtn = document.getElementById("logoutBtn");
    if (logoutBtn) {
      logoutBtn.addEventListener("click", (e) => {
        e.preventDefault();
        if (loggedInEmail) {
          const userData = localStorage.getItem(loggedInEmail);
          if (userData) {
            const user = JSON.parse(userData);
            user.isLog = false;
            localStorage.setItem(loggedInEmail, JSON.stringify(user));
            localStorage.removeItem("loggedInEmail");
            alert("You have been logged out.");
            window.location.href = "login.html";
          }
        }
      });
    }

    // Blog post creation functionality
    const postForm = document.getElementById("postForm");
    postForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const title = document.getElementById("title").value.trim();
      const content = document.getElementById("content").value.trim();
      const categoryId = document.getElementById("category_id").value.trim();
      const responseMessage = document.getElementById("responseMessage");

      if (!loggedInEmail) {
        responseMessage.textContent = "❌ You must be logged in to create a post.";
        responseMessage.style.color = "red";
        return;
      }

      const userData = localStorage.getItem(loggedInEmail);
      if (!userData) {
        responseMessage.textContent = "❌ User data not found.";
        responseMessage.style.color = "red";
        return;
      }

      const user = JSON.parse(userData);
      const token = user.token;

      fetch("https://test.blockfuselabs.com/api/posts", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`,
        },
        body: JSON.stringify({
          title: title,
          content: content,
          category_id: parseInt(categoryId)
        })
      })
      .then(response => {
        if (response.status === 201) {
          return response.json(); // ✅ Get the created post data
        } else {
          return response.text().then(text => {
            throw new Error(`❌ Error ${response.status}: ${text}`);
          });
        }
      })
      .then(createdPost => {
        console.log("✅ Post created successfully:");
        console.log(createdPost);

        // ✅ Save to localStorage
        localStorage.setItem(`Post_${createdPost.id}`, JSON.stringify(createdPost));

        // Optional: Update UI
        responseMessage.textContent = "✅ Post created and saved locally!";
        responseMessage.style.color = "green";
        postForm.reset();
      })
      .catch(error => {
        responseMessage.textContent = error.message;
        responseMessage.style.color = "red";
      });


      // const user = JSON.parse(userData);
      // const token = user.token;

      // fetch("https://test.blockfuselabs.com/api/posts", {
      //   method: "POST",
      //   headers: {
      //     "Content-Type": "application/json",
      //     "Authorization": `Bearer ${token}`,
      //   },
      //   body: JSON.stringify({
      //     title: title,
      //     content: content,
      //     category_id: parseInt(categoryId)
      //   })
      // })
      // .then(response => {
      //   if (response.status === 201) {
      //     responseMessage.textContent = "✅ Post created successfully!";
      //     responseMessage.style.color = "green";
      //     postForm.reset();
      //   } else {
      //     return response.text().then(text => {
      //       throw new Error(`❌ Error ${response.status}: ${text}`);
      //     });
      //   }
      // })
      // .catch(error => {
      //   responseMessage.textContent = error.message;
      //   responseMessage.style.color = "red";
      // });
    });
  </script>
</body>
</html>