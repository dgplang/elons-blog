<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elon Team's Blog</title>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css">
</head>
<body class="m-0 p-0 box-border">
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 w-full bg-[#f7f7f7] shadow-md z-50">
      <div class="container mx-auto px-5 md:px-20 py-3 flex items-center justify-between">
        <!-- Logo -->
        <div class="logo">
          <a href="index.html">
            <img src="media/logo.jpeg" alt="Elon Team Blog" class="w-1/6 md:w-1/4 logo-tint">
          </a>
        </div>

        <!-- Hamburger Icon -->
        <button id="menu" class="md:hidden text-gray-700 focus:outline-none w-6 h-6">
          <i class='bx bx-menu block text-2xl'></i>
          <i class='bx bx-x hidden text-2xl'></i>
        </button>

            <!-- Desktop Menu -->
            <ul id="nav-links" class="hidden md:flex space-x-6 items-center">
              <li><a href="index.html" class="text-[#0c4c8a] hover:text-[#1f3750] hover:border-b-2 border-[#0c4c8a]">Home</a></li>
              <li><a href="index.html" class="text-[#0c4c8a] hover:text-[#1f3750] hover:border-b-2 border-[#0c4c8a]">Blog</a></li>
              <li><a href="blogpost.html" class="text-[#0c4c8a] hover:text-[#1f3750] hover:border-b-2 border-[#0c4c8a] member">Manage Blog</a></li>
              <li><a href="index.html" class="text-[#0c4c8a] hover:text-[#1f3750] hover:border-b-2 border-[#0c4c8a]">Contact</a></li>
          </ul>

          <div id="myBtn" class="hidden md:flex space-x-4">
            <a href="login.html" class="px-4 py-2 bg-[#0c4c8a] hover:bg-[#1f3750] text-white rounded-md nonuser">Login</a>
            <a href="registration.html" class="px-4 py-2 bg-[#0c4c8a] hover:bg-[#1f3750] text-white rounded-md nonuser">Get Started</a>
            <a href="login.html" class="px-4 py-2 bg-[#0c4c8a] hover:bg-[#1f3750] text-white rounded-md user">Logout</a>
          </div>
      </div>

      <!-- Mobile Menu Container -->
      <div id="mobileMenu" class="md:hidden px-4 pb-4 hidden flex-col">
          <ul class="space-y-2">
              <li><a href="index.html" class="text-[#0c4c8a] hover:text-[#1f3750]">Home</a></li>
              <li><a href="index.html" class="text-[#0c4c8a] hover:text-[#1f3750]">Blog</a></li>
              <li><a href="blogpost.html" class="text-[#0c4c8a] hover:text-[#1f3750] hover:border-b-2 border-[#0c4c8a] member">Manage Blog</a></li>
              <li><a href="index.html" class="text-[#0c4c8a] hover:text-[#1f3750]">Contact</a></li>
          </ul>
          <div class="pt-4 space-y-2">
            <a href="login.html" class="px-4 py-2 bg-[#0c4c8a] hover:bg-[#1f3750] text-white rounded-md nonuser">Login</a>
            <a href="registration.html" class="px-4 py-2 bg-[#0c4c8a] hover:bg-[#1f3750] text-white rounded-md nonuser">Get Started</a>
            <a href="login.html" class="px-4 py-2 bg-[#0c4c8a] hover:bg-[#1f3750] text-white rounded-md user">Logout</a>
          </div>
      </div>
  </nav>
    <main class="pt-20 md:pt-24">
      <div class="flex flex-col items-center">
        <div class="flex flex-col md:flex-row items-center md:items-start justify-between my-6 md:my-0 mx-5 md:mx-20">
          <div class="flex flex-col p-0 m-0 w-full md:w-3/4">
            <div class="w-full text-2xl md:text-3xl font-semibold text-gray-700 pb-5" id="blogtitle"></div>
                  <div class="w-full overflow-hidden">
                      <img src="media/iot2.jpeg" alt="IoT" class="w-full h-60 md:h-96 object-cover">
                      <div class="px-0 py-4 text-center">
                        <p class="text-lg font-semibold leading-tight text-gray-800 text-center">
                          Internet of Things (IoT)
                        </p>
                      </div>
                    </div>
                  <div class="w-full xs:text-sm sm:text-base md:text-lg text-justify leading-relaxed" id="blogpost">
                  </div>

                  <div class="w-full mx-auto my-6 p-4 sm:p-6 bg-[#0c4c8a] rounded-lg shadow-lg">
                    <!-- Comment Form -->
                    <div class="mb-6">
                      <h2 class="text-xl sm:text-2xl font-semibold text-white mb-4">Leave a Comment</h2>
                      <form class="space-y-4">
                        <div>
                          <label for="comment" class="block text-sm font-medium text-white">Comment</label>
                          <textarea
                          id="commentInput"
                            rows="4"
                            class="mt-1 w-full p-3 rounded-md border border-[#194585] bg-white text-[#26355b] focus:ring-[#89d7de] focus:border-[#89d7de] text-sm sm:text-base"
                            placeholder="Write your comment here..."
                            required
                          ></textarea>
                        </div>
                        <button id="postCommentBtn"
                          type="submit"
                          class="w-full sm:w-auto px-6 py-2 bg-[#64fcfd] text-[#26355b] rounded-md hover:bg-[#26355b] hover:text-white transition-colors text-sm sm:text-base"
                        >
                          Post Comment
                        </button>
                      </form>
                      <p id="commentResponse"></p>
                    </div>
                  
                    <!-- Comment List -->
                    <div>
                      <h2 class="text-xl sm:text-2xl font-semibold text-white mb-4">Comments</h2>
                      <div id="commentsContainer" class="space-y-4">
                    </div>
                  </div>
                  </div>
              </div>
              <div class="w-full md:w-1/4">
                <div class="pb-1 pl-0 md:pl-4 pt-2 w-full text-2xl font-normal">Related posts</div>
                <div class="pl-0 md:pl-4">
                    <!-- Posts Container -->
                      <div class="flex flex-col">
                        <!-- Single Post -->
                        <div class="w-full leading-relaxed hover:underline flex items-center">
                          <a href="iot1.html" target="_self" class="flex items-center">
                              <img src="media/iot1.jpeg" alt="Smart Homes" class="w-16 h-16 object-cover">
                              <div class="p-3 flex-1">
                              <h3 class="text-base font-semibold text-gray-800 line-clamp-3">What is IoT? - Future of a Connected World</h3>
                              </div>
                          </a>
                        </div>
                        <!-- Single Post -->
                        <div class="w-full leading-relaxed hover:underline flex items-center">
                          <a href="iot2.html" target="_self" class="flex items-center">
                              <img src="media/iot2.jpeg" alt="Post thumbnail" class="w-16 h-16 object-cover">
                              <div class="p-3 flex-1">
                              <h3 class="text-base font-semibold text-gray-800 line-clamp-3">Smart Homes - How IoT is Changing the Way We Live</h3>
                              </div>
                          </a>
                        </div>
                        <!-- Single Post -->
                        <div class="w-full leading-relaxed hover:underline flex items-center">
                          <a href="iot3.html" target="_self" class="flex items-center">
                              <img src="media/iot3.jpeg" alt="Post thumbnail" class="w-16 h-16 object-cover">
                              <div class="p-3 flex-1">
                              <h3 class="text-base font-semibold text-gray-800 line-clamp-3">IoT in Healthcare - Saving Lives with Smart Devices</h3>
                              </div>
                          </a>
                        </div>
                        <!-- Single Post -->
                        <div class="w-full leading-relaxed hover:underline flex items-center">
                          <a href="iot4.html" target="_self" class="flex items-center">
                              <img src="media/iot4.jpeg" alt="Post thumbnail" class="w-16 h-16 object-cover">
                              <div class="p-3 flex-1">
                              <h3 class="text-base font-semibold text-gray-800 line-clamp-3">Industrial IoT - Making Factories Smarter and Safer</h3>
                              </div>
                          </a>
                        </div>
                        <!-- Single Post -->
                        <div class="w-full leading-relaxed hover:underline flex items-center">
                            <a href="iot5.html" target="_self" class="flex items-center">
                                <img src="media/iot5.jpeg" alt="Post thumbnail" class="w-16 h-16 object-cover">
                                <div class="p-3 flex-1">
                                <h3 class="text-base font-semibold text-gray-800 line-clamp-3">The Challenges and Future of IoT Technology</h3>
                                </div>
                            </a>
                        </div>
                      </div>
                  </div>
              </div>
            </div>
        </div> 
    </main>
    <!-- footer  -->
    <footer class="bg-[#0c4c8a] hover:bg-[#1f3750] py-3">
        <div class="text-white text-center">
            <span>&copy; Blockfuse Labs, The Elon Team, Cohort 2 Web2 Beginners, 2025.</span>
            <p><a href="https://github.com/dgplang/elons-blog-project" target="_blank" class="hover:underline text-white">GitHub Link</a> </p>
        </div>
    </footer>
    <script>
      const getPostDetails = () => {
        fetch("https://test.blockfuselabs.com/api/posts/49", {
          method: "GET",
          headers: {
            "Accept": "*/*"
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          console.log("✅ Post details fetched:", data);
    
          // Populate the DOM
          document.getElementById("blogtitle").textContent = data.title;
          document.getElementById("blogpost").innerHTML = data.content;
        })
        .catch(error => {
          console.error("❌ Error fetching post details:", error.message);
        });
      };
    
      // Call it on page load
      window.onload = getPostDetails;

      // Ensure the event is attached after the DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        const commentInput = document.getElementById("commentInput");
        const responseMessage = document.getElementById("commentResponse");
        const postButton = document.getElementById("postCommentBtn");

        postButton.addEventListener("click", (event) => {
          event.preventDefault(); // ⛔ Prevent page reload if inside a form

          const userData = localStorage.getItem('loggedInEmail');
          if (!userData) {
            responseMessage.textContent = "❌ User not logged in.";
            responseMessage.style.color = "red";
            return;
          }

          const user = JSON.parse(localStorage.getItem(userData));
          if (!user || !user.email) {
            responseMessage.textContent = "❌ User session is invalid or expired.";
            responseMessage.style.color = "red";
            return;
          }

          const token = user.token;
          const commentContent = commentInput.value.trim();

          if (!commentContent) {
            responseMessage.textContent = "❌ Please enter a comment.";
            responseMessage.style.color = "red";
            return;
          }

          const commentData = {
            content: commentContent
          };

          console.log("📤 Sending comment:", commentData);

          fetch("https://test.blockfuselabs.com/api/posts/49/comments", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Accept": "*/*",
              "Authorization": `Bearer ${token}`
            },
            body: JSON.stringify(commentData)
          })
          .then(response => {
            console.log("📩 Raw response received:", response);
            if (response.status === 201) {
              return response.json(); // Expect JSON if created
            } else {
              return response.text().then(text => {
                throw new Error(`❌ Error ${response.status}: ${text}`);
              });
            }
          })
          .then(data => {
              commentInput.value = ""; // Clear input
              loadComments();          // Reload comments
          });

          commentBlock.innerHTML = `
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-sm sm:text-base font-medium text-[#26355b]">${data.user.name}</h3>
              <span class="text-xs sm:text-sm text-gray-500">${time}</span>
            </div>
            <p class="text-sm sm:text-base text-[#26355b] text-justify leading-tight">${data.content}</p>
          `;

            const commentsContainer = document.getElementById("commentsContainer");
            commentsContainer.prepend(commentBlock); // Insert at top
          })
          .catch(error => {
            console.error("❌ Error during fetch:", error.message);
            responseMessage.textContent = error.message;
            responseMessage.style.color = "red";
          });
        });

      function loadComments() {
        const commentsContainer = document.getElementById("commentsContainer");
        commentsContainer.innerHTML = ""; // Clear existing comments

        fetch("https://test.blockfuselabs.com/api/posts/49/comments", {
          method: "GET",
          headers: {
            Accept: "*/*",
          },
        })
        .then(response => response.json())
        .then(comments => {
          comments.forEach(comment => {
            const commentBlock = document.createElement("div");
            commentBlock.className = "p-4 bg-white rounded-md shadow-sm animate-comment";

            const time = new Date(comment.created_at).toLocaleString("en-US", {
              dateStyle: "medium",
              timeStyle: "short",
            });

            commentBlock.innerHTML = `
              <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm sm:text-base font-medium text-[#26355b]">${comment.user.name}</h3>
                <span class="text-xs sm:text-sm text-gray-500">${time}</span>
              </div>
              <p class="text-sm sm:text-base text-[#26355b] text-justify leading-tight">${comment.content}</p>
            `;

            commentsContainer.appendChild(commentBlock);
          });
        })
        .catch(error => {
          console.error("Error fetching comments:", error);
          commentsContainer.innerHTML = "<p class='text-red-500'>Failed to load comments.</p>";
        });
      }

      document.addEventListener("DOMContentLoaded", function () {
        loadComments();
      });
    </script>
    <script src="script.js"></script>
</body>
</html>